{% extends 'base.html' %}
{% load form_filters %}
{% load filtros_paraguay %}

{% block content %}
<div class="container mx-auto px-4 py-6">
  <div class="bg-white shadow rounded-lg overflow-hidden">
    <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
      <h1 class="text-xl font-semibold text-gray-800">{{ titulo }}</h1>
    </div>
    
    <div class="p-6">
      <!-- Información de la cuenta -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
        <div>
          <h2 class="text-lg font-medium text-gray-900 mb-4">Detalles de la Cuenta</h2>
          <div class="space-y-3">
            <p><strong>Venta:</strong> <a href="{% url 'ventas:detalle_venta' cuenta.venta.id %}" class="text-blue-600 hover:underline">{{ cuenta.venta.numero }}</a></p>
            <p><strong>Cliente:</strong> {{ cuenta.venta.cliente.nombre_completo }}</p>
            <p><strong>Cuota N°:</strong> {{ cuenta.numero_cuota }}</p>
            <p><strong>Monto Total:</strong> Gs. {{ cuenta.monto|pyg_intcomma }}</p>
            <p><strong>Saldo Pendiente:</strong> Gs. {{ cuenta.saldo|pyg_intcomma }}</p>
          </div>
        </div>
        
        <div>
          <h2 class="text-lg font-medium text-gray-900 mb-4">Fechas y Estado</h2>
          <div class="space-y-3">
            <p><strong>Vencimiento:</strong> {{ cuenta.fecha_vencimiento|date:"d/m/Y" }}</p>
            <p><strong>Días de atraso:</strong> {% if cuenta.dias_vencido > 0 %}{{ cuenta.dias_vencido }} días{% else %}Al día{% endif %}</p>
            <p>
              <strong>Estado:</strong> 
              <span class="px-2 py-1 text-xs rounded-full 
                {% if cuenta.estado == 'PAGADA' %}bg-green-100 text-green-800
                {% elif cuenta.estado == 'VENCIDA' %}bg-red-100 text-red-800
                {% elif cuenta.estado == 'PENDIENTE' %}bg-yellow-100 text-yellow-800
                {% else %}bg-blue-100 text-blue-800{% endif %}">
                {{ cuenta.get_estado_display }}
              </span>
            </p>
            {% if cuenta.fecha_pago %}
            <p><strong>Fecha de pago:</strong> {{ cuenta.fecha_pago|date:"d/m/Y" }}</p>
            {% endif %}
          </div>
        </div>
      </div>
      
      <!-- Acciones -->
      <div class="mb-8">
        {% if cuenta.saldo > 0 %}
        <a href="{% url 'ventas:registrar_pago' cuenta.id %}" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 inline-flex items-center">
          <i class="fas fa-money-bill-wave mr-2"></i> Registrar Pago
        </a>
        {% endif %}
      </div>
      
      <!-- Histórico de pagos -->
      <h2 class="text-lg font-medium text-gray-900 mb-4">Histórico de Pagos</h2>
      {% if pagos %}
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Fecha</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Monto</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Método</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Registrado por</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Notas</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            {% for pago in pagos %}
            <tr>
              <td class="px-6 py-4 whitespace-nowrap">{{ pago.fecha_pago|date:"d/m/Y" }}</td>
              <td class="px-6 py-4 whitespace-nowrap">Gs. {{ pago.monto|pyg_intcomma }}</td>
              <td class="px-6 py-4 whitespace-nowrap">{{ pago.get_tipo_pago_display }}</td>
              <td class="px-6 py-4 whitespace-nowrap">{{ pago.registrado_por.usuario.get_full_name }}</td>
              <td class="px-6 py-4">{{ pago.notas|default:"-" }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <p class="text-gray-500">No se han registrado pagos para esta cuenta.</p>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}